<!doctype html>\n<html>\n<head>\n    <title>Website Monitor Agency</title>\n    <style>\n        body { font-family: sans-serif; margin: 20px; }\n        #chatbox { height: 500px; width: 100%; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }\n        .message { margin-bottom: 10px; padding: 5px; border-radius: 5px; }\n        .user { background-color: #e1f5fe; text-align: right; margin-left: 40px;}\n        .assistant { background-color: #f1f1f1; margin-right: 40px; }\n        #input-area { display: flex; }\n        #input-area input { flex-grow: 1; padding: 10px; margin-right: 10px; }\n        #input-area button { padding: 10px; }\n        #logout { position: absolute; top: 10px; right: 10px; }\n    </style>\n</head>\n<body>\n    <h1>Website Monitor Agency</h1>\n    <div id=\"logout\"><a href=\"{{ url_for(\'logout\') }}\">Logout</a></div>\n\n    <div id=\"chatbox\">\n        <!-- Chat messages will appear here -->\n    </div>\n\n    <form id=\"input-area\">\n        <input type=\"text\" id=\"message-input\" placeholder=\"Enter task (e.g., monitor URL X with selector Y)\" autocomplete=\"off\">\n        <button type=\"submit\">Send</button>\n    </form>\n\n    <script>\n        const chatbox = document.getElementById(\'chatbox\');\n        const messageInput = document.getElementById(\'message-input\');\n        const inputForm = document.getElementById(\'input-area\');\n\n        function addMessage(role, text) {\n            const messageDiv = document.createElement(\'div\');\n            messageDiv.classList.add(\'message\', role);\n            // Basic sanitization to prevent HTML injection\n            const textNode = document.createTextNode(text);\n            messageDiv.appendChild(textNode);\n            chatbox.appendChild(messageDiv);\n            chatbox.scrollTop = chatbox.scrollHeight; // Scroll to bottom\n        }\n\n        inputForm.addEventListener(\'submit\', async (event) => {\n            event.preventDefault(); // Prevent default form submission\n            const message = messageInput.value.trim();\n            if (!message) return;\n\n            addMessage(\'user\', message);\n            messageInput.value = \'\'; // Clear input\n            messageInput.disabled = true; // Disable input while waiting\n\n            try {\n                const response = await fetch(\"{{ url_for(\'chat_api\') }}\", {\n                    method: \'POST\',\n                    headers: {\n                        \'Content-Type\': \'application/json\',\n                    },\n                    body: JSON.stringify({ message: message })\n                });\n\n                if (!response.ok) {\n                    throw new Error(`HTTP error! status: ${response.status}`);\n                }\n\n                const data = await response.json();\n                addMessage(\'assistant\', data.response);\n\n            } catch (error) {\n                console.error(\'Error fetching chat response:\', error);\n                addMessage(\'assistant\', `Error: ${error.message}. Check server logs.`);\n            }\n            finally {\n                 messageInput.disabled = false; // Re-enable input\n                 messageInput.focus();\n            }\n        });\n\n        // Initial focus\n        messageInput.focus();\n\n    </script>\n</body>\n</html> 